"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _express = _interopRequireDefault(require("express"));

var _wolfy87Eventemitter = _interopRequireDefault(require("wolfy87-eventemitter"));

var _ModelsController = _interopRequireDefault(require("./ModelsController"));

var _StreamingController = _interopRequireDefault(require("./StreamingController"));

var _CentralController = _interopRequireDefault(require("./CentralController"));

var _constants = _interopRequireDefault(require("../lib/constants"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const makeController = (db, config) => {
  const router = _express.default.Router();

  const radiksCollection = db.collection(_constants.default.COLLECTION);
  const centralCollection = db.collection(_constants.default.CENTRAL_COLLECTION);
  router.options('*', (req, res, next) => {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Headers', 'origin, content-type');
    res.header('Access-Control-Allow-Methods', 'POST, GET, OPTIONS, DELETE');
    next();
  });
  router.use((req, res, next) => {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Headers', 'origin, content-type');
    res.header('Access-Control-Allow-Methods', 'POST, GET, OPTIONS, DELETE');
    next();
  });
  const emitter = new _wolfy87Eventemitter.default();
  router.use('/models', (0, _ModelsController.default)(radiksCollection, config, emitter));
  router.use('/stream', (0, _StreamingController.default)(radiksCollection, emitter));
  router.use('/central', (0, _CentralController.default)(radiksCollection, centralCollection));
  router.db = radiksCollection; // for backwards compatibility

  router.DB = db;
  router.radiksCollection = radiksCollection;
  router.centralCollection = centralCollection;
  router.emitter = emitter;
  return router;
};

var _default = makeController;
exports.default = _default;
module.exports = exports.default;